---

- name: install minimal packages
  apt:
    name: "{{ item }}"
    state: present
    install_recommends: no
  with_items:
    - rsync # for ansible synchronize
    - acl   # so ansible can share tmp files with unprivileged users
    - firewalld
    - sudo
    - etckeeper
    - iptables
    - htop
    - less
    - lsof
    - traceroute
    - nethogs
    - nload
    - git
    - vim
    - htop
    - grep
    - tmux
    - yubikey-personalization # for the yubikey udev rules
    - pastebinit
    - debsecan
    - popularity-contest


- name: enable and start firewalld
  service:
    name: firewalld
    state: started
    enabled: yes


- name: enable popularity-contest
  lineinfile: >
    dest=/etc/popularity-contest.conf
    regexp=^PARTICIPATE= line=PARTICIPATE="yes"
  when: "'vagrant' not in group_names"
